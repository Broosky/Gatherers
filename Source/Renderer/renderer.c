/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Program Name: Gatherers (C)                                                                                             //
// Author: Jeffrey Bednar                                                                                                  //
// Copyright (c) Illusion Interactive, 2011 - 2025.                                                                        //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#include "../../Headers/globals.h"
#include "../../Headers/log.h"
#include "../../Headers/misc.h"
#include "../../Headers/Renderer/renderer.h"
#include "../../Headers/Renderer/renderer_direct_2d.h"
#include "../../Headers/Renderer/renderer_double_buffer.h"
#include "../../Headers/Renderer/renderer_sdl.h"
#include "../../Headers/Renderer/renderer_single_buffer.h"
#include "../../Headers/Renderer/renderer_wireframe.h"
#include <stdlib.h>
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
static const RENDERER_CREATE RendererCreation[] = {
    [RENDERER_TYPE_WIREFRAME] = WIREFRAME_Create,
    [RENDERER_TYPE_SINGLE_BUFFER] = SINGLE_BUFFER_Create,
    [RENDERER_TYPE_DOUBLE_BUFFER] = DOUBLE_BUFFER_Create,
    [RENDERER_TYPE_SDL] = SDL_Create,
    [RENDERER_TYPE_DIRECT2D] = DIRECT_2D_Create,
};
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void __cdecl RENDERER_Zero(RENDERER_T* p_Renderer) {
    ZeroMemory(p_Renderer, sizeof(RENDERER_T));
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
RENDERER_T* __cdecl RENDERER_Create(RENDERER_TYPE_T eType, GLOBALS_T* p_Globals, LOG_T* p_Log) {
    size_t stAllocation = sizeof(RENDERER_T);
    RENDERER_T* p_Renderer = malloc(stAllocation);
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    if (!p_Renderer) {
        MISC_WriteOutParams(p_Log, LOG_SEVERITY_FATAL, "RENDERER_Create(): Malloc failed for size: %zu bytes\n", stAllocation);
        return NULL;
    }
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    p_Globals->stAllocations += stAllocation;
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    RENDERER_Zero(p_Renderer);
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    p_Renderer->eType = eType;
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    if (!RendererCreation[eType](p_Renderer, p_Globals, p_Log)) {
        MISC_WriteOutParams(p_Log, LOG_SEVERITY_FATAL, "RENDERER_Create(): Unable to create %s renderer.\n", MISC_GetRendererTypeName(eType));
        return NULL;
    }
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    return p_Renderer;
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Main routine for killing an implementation of the renderer.
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void __cdecl RENDERER_Kill(RENDERER_T** pp_Renderer, GLOBALS_T* p_Globals) {
    RENDERER_T* p_Renderer = *pp_Renderer;
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    if (p_Renderer) {
        p_Renderer->Kill(p_Renderer, p_Globals);
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        free(p_Renderer);
        p_Globals->stAllocations -= sizeof(RENDERER_T);
        *pp_Renderer = NULL;
    }
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
