/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Program Name: Gatherers (C)                                                                                             //
// Author: Jeffrey Bednar                                                                                                  //
// Copyright (c) Illusion Interactive, 2011 - 2025.                                                                        //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#include "../Headers/assets.h"
#include "../Headers/common.h"
#include "../Headers/constants.h"
#include "../Headers/double_buffer.h"
#include "../Headers/load.h"
#include "../Headers/settings.h"
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Define externs.
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
DOUBLE_BUFFER_T* p_DoubleBuffer = NULL;
SETTINGS_T* p_Settings = NULL;
ASSETS_T* p_Assets = NULL;
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
INT_PTR CALLBACK WINDOWS_PROCEDURE_DlgLoad(HWND hWnd, UINT uiMsg, WPARAM wParam, LPARAM lParam) {
    static HBRUSH hBrush;
    switch (uiMsg) {
    case WM_INITDIALOG: {
        PostMessage(hWnd, WM_SETICON, ICON_BIG, lParam);
        PostMessage(hWnd, WM_SETICON, ICON_SMALL, lParam);
        SetTimer(hWnd, 50, 250, NULL);
        break;
    }
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // WinAsm studio does not allow us to change the colour properties of the label. Manually do it.
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    case WM_CTLCOLORSTATIC: {
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // Set the device context to the label.
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        HDC hDC = (HDC)wParam;
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // Change the properties of the labels text (only the text).
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        SetTextColor(hDC, RGB(170, 235, 250));
        SetBkColor(hDC, RGB(0, 0, 0));
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // Change the properties of the labels background colour (the entire label).
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        hBrush = CreateSolidBrush(RGB(0, 0, 0));
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // The colour the system will draw the label with.
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        return (INT_PTR)hBrush;
    }
    case WM_TIMER: {
        SetDlgItemText(hWnd, DLG_LOAD_STATUS, "Loading program settings...");
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        SETTINGS_InitFromFile(p_Settings);
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        SetDlgItemText(hWnd, DLG_LOAD_STATUS, "Ready.");
        SetDlgItemText(hWnd, DLG_LOAD_STATUS, "Loading images...");
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ASSETS_InitFromFile(p_Assets, hWnd);
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        SetDlgItemText(hWnd, DLG_LOAD_STATUS, "Ready.");
        PostMessage(hWnd, WM_CLOSE, 0, 0);
        break;
    }
    case WM_CLOSE: {
        DeleteObject(hBrush);
        KillTimer(hWnd, 50);
        EndDialog(hWnd, 0);
        break;
    }
    default: {
        return 0;
    }
    }
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // I handled a message.
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    return 0;
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
